name: ICPC compile

on:
  push:
    branches: test-ci
  pull_request:
    branches: test-ci

jobs:
  build:

    runs-on: ubuntu-18.04
    container: jojoelfe/cistem_ci



    steps:
    - uses: actions/checkout@v2
    - name: regenerate_project
      run: ./regenerate_project.b
    - name: set path
      run: echo "/opt/intel/oneapi/compiler/2021.4.0/linux/bin/intel64" >> $GITHUB_PATH
    - name: configure
      run: |
        echo "$PATH"
        mkdir -p build/icpc 
        cd build/icpc 
        CXX=icpc CC=icc ../../configure  --enable-experimental --enable-staticmode --enable-openmp  --with-wx-config=wx-config 
    - name: make
      run: |
        cd build/icpc
        make -j4
    - name: setup python
      run: |
        cd src/pycistem
        bash setup_python.sh
    #- name: build python extension
    #  run: |
    #    cp src/pycistem/setup.py build/icpc/ 
    #    cd build/icpc 
    #    ../../src/pycistem/pycistem-venv/bin/python setup.py build_ext --inplace
    - name: Create binary artifact
      uses: actions/upload-artifact@v2
      with: 
        name: cistem_binaries
        path: build/icpc/src
